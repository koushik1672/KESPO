<!DOCTYPE html>
<html>
<head>
    <title>KESPO | My Harvests</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h2>My Harvest Listings</h2>

<a href="{{ url_for('dashboard') }}">â† Back to Dashboard</a><br><br>

<!-- âœ… FLASH MESSAGES (IMPORTANT) -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert {{ category }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% if harvests|length == 0 %}
<p>You have not uploaded any harvests yet.</p>
{% endif %}

{% for h in harvests %}
<div class="card">
    <img src="{{ url_for('static', filename='uploads/' ~ h.image) }}" width="200"><br><br>

    <b>Quantity:</b> {{ h.quantity }} Tons<br>
    <b>Price:</b> â‚¹ {{ h.expected_price }} per KG<br>
    <b>Deal Value:</b> â‚¹ {{ h.deal_value }}<br>
    <b>Harvest Date:</b> {{ h.harvest_date }}<br>
    <b>Status:</b> {{ h.status | upper }}<br>

    {% if h.rejection_reason %}
        <p style="color:red;">
            <b>Rejection Reason:</b> {{ h.rejection_reason }}
        </p>
    {% endif %}

    <br>

    {% if h.status == "pending" %}
        <a href="{{ url_for('edit_harvest', id=h.id) }}">âœï¸ Edit</a> |
        <a href="{{ url_for('delete_harvest', id=h.id) }}"
           onclick="return confirm('Delete this harvest permanently?')">
            ğŸ—‘ Delete
        </a>
    {% else %}
        <i>Actions locked</i>
    {% endif %}
</div>
{% endfor %}

</body>
</html>
